1
00:00:00,318 --> 00:00:02,467
プレイヤーを作成するうえで次のステップは

2
00:00:02,467 --> 00:00:04,007
PlayerHealth スクリプトの作成です。

3
00:00:04,511 --> 00:00:06,511
プレイヤーを Hierarchy で選択して

4
00:00:06,511 --> 00:00:09,151
Add Component - New Script を選択して、

5
00:00:09,151 --> 00:00:11,151
PlayerHealth と名前をつけます。

6
00:00:12,024 --> 00:00:14,024
アイコンをダブルクリックして、編集のために開き

7
00:00:14,024 --> 00:00:16,024
スクリプトの準備をします。

8
00:00:17,270 --> 00:00:19,270
このクラスではパブリック変数は

9
00:00:19,270 --> 00:00:22,194
いくつかあれば十分です。最初に

10
00:00:22,194 --> 00:00:24,194
プレイヤーの生命力（Health）を示す float 変数です。

11
00:00:24,194 --> 00:00:26,194
これは public としますが、

12
00:00:26,194 --> 00:00:28,194
その理由はインスペクタで調整できるようにするためではなく

13
00:00:28,194 --> 00:00:30,194
他のスクリプトから参照が

14
00:00:30,194 --> 00:00:32,194
できるようにして、プレイヤーがまだ生きているか

15
00:00:32,194 --> 00:00:34,194
判定できるようにするためです。

16
00:00:34,777 --> 00:00:36,777
もしプレイヤーが死んだとき、

17
00:00:36,777 --> 00:00:39,423
レベルをリセットします。しかし、これを行なう時間が短すぎると

18
00:00:39,423 --> 00:00:41,854
プレイヤーが死ぬアニメーションをみることが出来ず

19
00:00:41,854 --> 00:00:43,219
中途半端です。

20
00:00:43,219 --> 00:00:45,219
このため、少し遅延させます。

21
00:00:45,219 --> 00:00:47,219
これを行なうため、待つ時間の長さを

22
00:00:47,219 --> 00:00:49,219
float 変数に格納します。

23
00:00:50,092 --> 00:00:52,092
最後に必要となる public 変数は

24
00:00:52,092 --> 00:00:54,092
プレイヤーが死ぬときに再生される

25
00:00:54,092 --> 00:00:56,755
オーディオクリップです。いくつかのプレイベート変数が

26
00:00:56,755 --> 00:00:59,269
このクラスには必要であり、他のコンポーネントやスクリプトを

27
00:00:59,269 --> 00:01:01,269
参照するために用意します。

28
00:01:01,269 --> 00:01:03,269
最初にアニメータ コンポーネントへの参照が

29
00:01:03,269 --> 00:01:05,269
必要です。さらに PlayerMovement スクリプトへの参照が

30
00:01:05,269 --> 00:01:07,560
必要であり、これにより

31
00:01:07,560 --> 00:01:09,560
プレイヤーが死んだときにこれを無効化して

32
00:01:09,560 --> 00:01:11,560
プレイヤーが動かないようにします。

33
00:01:12,226 --> 00:01:14,226
アニメータ コンポーネントを使用して

34
00:01:14,226 --> 00:01:16,625
ステートを参照するため

35
00:01:16,625 --> 00:01:18,625
HashIDs スクリプトへの参照が必要です。

36
00:01:19,333 --> 00:01:21,333
プレイヤーが死ぬとき、

37
00:01:21,333 --> 00:01:23,333
上手にフェードアウトさせたいため

38
00:01:23,333 --> 00:01:26,250
SceneFadeInOut スクリプトへの参照が必要です。

39
00:01:27,137 --> 00:01:29,137
さらにプレイヤーが死ぬとき、

40
00:01:29,137 --> 00:01:31,605
アラームがオフになるようにします。

41
00:01:31,605 --> 00:01:33,605
これらはプレイヤーを最後にみつけたことにもとづいているため、

42
00:01:33,605 --> 00:01:34,603
LastPlayerSighting スクリプトへの参照が

43
00:01:34,603 --> 00:01:36,603
必要です。

44
00:01:37,352 --> 00:01:39,352
プレイヤーが死ぬときから、

45
00:01:39,352 --> 00:01:41,532
シーンがリセットするまでの時間を数える

46
00:01:41,532 --> 00:01:43,143
タイマーが必要です。

47
00:01:43,643 --> 00:01:45,643
最後に boolean 変数を使用して

48
00:01:45,643 --> 00:01:48,489
プレイヤーが死んでいるかどうか示します。

49
00:01:48,489 --> 00:01:51,081
これをプレイヤーの生命力（Health) の値と組み合わせて

50
00:01:51,081 --> 00:01:53,081
プレイヤーが死んだときに行なわれるアクションを

51
00:01:53,081 --> 00:01:55,081
行なうタイミングを決定します。

52
00:01:55,081 --> 00:01:58,084
次に Awake 関数を使用して

53
00:01:58,084 --> 00:02:00,084
参照の割り当てを行ないます。

54
00:02:34,824 --> 00:02:36,824
主に 4 つの関数をこのスクリプトで

55
00:02:36,824 --> 00:02:38,824
使用します。初めに

56
00:02:38,824 --> 00:02:40,824
PlayerDying function の作成を行ないます。

57
00:02:41,835 --> 00:02:43,459
プレイヤーが死んだときに最初に行なうことは

58
00:02:43,459 --> 00:02:46,920
boolean である playerDead 変数を true にすることです。

59
00:02:47,420 --> 00:02:49,420
この boolean により 関数がコールされる

60
00:02:49,420 --> 00:02:51,420
決定します。

61
00:02:51,420 --> 00:02:53,420
この boolean を true にすることで

62
00:02:53,420 --> 00:02:56,040
関数がコールされるのが 1 回のみとなることを保証します。

63
00:02:56,540 --> 00:02:58,540
次に Animator パラメータである Dead に

64
00:02:58,540 --> 00:03:02,644
true をセットします。これにより Dying アニメーションをトリガーします。

65
00:03:04,470 --> 00:03:07,320
最後に Dying オーディオ クリップを再生します。

66
00:03:07,320 --> 00:03:09,781
PlayClipAtPoint を使用するのは、

67
00:03:09,781 --> 00:03:11,781
足音 (footsteps) オーディオを停止させたいものの

68
00:03:11,781 --> 00:03:13,781
プレイヤーの オーディオ ソースはループ再生にセットされているため、

69
00:03:13,781 --> 00:03:15,781
Dying オーディオクリップと

70
00:03:15,781 --> 00:03:18,756
置き換えをしたくないためです。

71
00:03:18,756 --> 00:03:21,852
PlayClipAtPoint 関数は一回だけ再生をされます。

72
00:03:22,863 --> 00:03:25,572
次に PlayerDead 関数を作成します。

73
00:03:25,572 --> 00:03:27,572
PlayerDying 関数がコールされるときに、

74
00:03:27,572 --> 00:03:29,572
コールされ、その後の Update ごとに毎回

75
00:03:29,572 --> 00:03:31,572
コールされます。

76
00:03:32,790 --> 00:03:34,790
最初に Dying アニメーションに遷移したか

77
00:03:34,790 --> 00:03:37,277
確認をします。

78
00:03:41,475 --> 00:03:45,114
GetCurrentAnimatorStateInfo の引数の 0 は

79
00:03:45,114 --> 00:03:47,114
Base Layer への参照を示すことを覚えてください。

80
00:03:47,114 --> 00:03:49,114
つまり Base Layer が

81
00:03:49,114 --> 00:03:51,114
Dying のステートであるか確認をしています。

82
00:03:51,114 --> 00:03:53,114
そして、もしそのステートであル場合、

83
00:03:53,114 --> 00:03:55,832
Any State からの遷移が再度起きることはさける必要があります。

84
00:03:55,832 --> 00:03:57,832
このために Animator パラメータ deadBool を

85
00:03:57,832 --> 00:03:59,832
false にします。これにより Death (死亡) アニメーションは

86
00:03:59,832 --> 00:04:01,832
一回だけ再生されます。

87
00:04:03,741 --> 00:04:05,741
次にプレイヤーの動作を停止する必要があります。

88
00:04:06,407 --> 00:04:08,990
これを行なうために Speed を 0 にセットして

89
00:04:08,990 --> 00:04:11,638
PlayerMovement を無効化します。

90
00:04:15,895 --> 00:04:17,895
lastPlayerSighting をセットして、

91
00:04:17,895 --> 00:04:19,895
リセットするときの位置にして

92
00:04:19,895 --> 00:04:22,512
アラームがオフになるようにします。

93
00:04:24,839 --> 00:04:26,490
プレイヤーによる足音 (footstep) の音声も

94
00:04:26,490 --> 00:04:29,098
停止させる必要があります。

95
00:04:30,744 --> 00:04:32,744
次にプレイヤーが死ぬときのために

96
00:04:32,744 --> 00:04:35,843
LevelReset 関数を作成します。

97
00:04:38,221 --> 00:04:40,221
この関数で最初にすべきことは

98
00:04:40,221 --> 00:04:42,221
タイマーをインクリメントすることです。

99
00:04:42,721 --> 00:04:44,632
次にタイマーがレベルをリセットするまでの時間を上回ったか

100
00:04:44,632 --> 00:04:47,366
確認する必要があり、

101
00:04:47,366 --> 00:04:49,366
EndScene 関数を

102
00:04:49,366 --> 00:04:52,767
SceneFadeInOut クラスの中からコールします。

103
00:04:54,137 --> 00:04:56,137
次に Update 関数を作成して

104
00:04:56,137 --> 00:04:58,137
これら 3 つの関数を適切なタイミングで

105
00:04:58,137 --> 00:05:00,913
コールできます。 Update を

106
00:05:00,913 --> 00:05:02,913
スクリプトの PlayerDying の上に配置しますが、

107
00:05:02,913 --> 00:05:04,913
関数の順番は重要では

108
00:05:04,913 --> 00:05:06,913
ありません。しかし

109
00:05:06,913 --> 00:05:09,456
スクリプトの関数の流れを決めておくと便利です。

110
00:05:09,456 --> 00:05:13,144
Awake が最初にコールされて、次にフレームの Update がコールされ、

111
00:05:13,144 --> 00:05:15,586
その中で Update は PlayerDying、

112
00:05:15,586 --> 00:05:18,215
PlayerDead または levelReset をときどきコールします。

113
00:05:18,215 --> 00:05:20,215
スクリプトのレイアウトを考えるとき

114
00:05:20,215 --> 00:05:22,839
自分にとって意味のある順番とするべきです。

115
00:05:22,839 --> 00:05:25,551
Update 関数では最初に

116
00:05:25,551 --> 00:05:27,551
health 変数が 0 以下であるか

117
00:05:27,551 --> 00:05:29,55
確認します。1

118
00:05:30,327 --> 00:05:32,327
次に boolean である playerDead が false であるか

119
00:05:32,327 --> 00:05:35,933
確認します。これが false であるときは

120
00:05:35,933 --> 00:05:38,238
PlayerDying 関数がコールできることを覚えておくべきです。

121
00:05:38,238 --> 00:05:40,238
コールされるのは一回だけであり、

122
00:05:40,238 --> 00:05:42,795
それは playerDying の冒頭で

123
00:05:42,795 --> 00:05:44,795
playerDead を true にセットするためです。

124
00:05:46,621 --> 00:05:49,496
もし playerDying がコールされて

125
00:05:49,496 --> 00:05:51,496
boolean である playerDead が true である場合

126
00:05:51,496 --> 00:05:54,252
PlayerDead および LevelReset をコールすべきです。

127
00:05:55,723 --> 00:05:57,723
最後にスクリプトのなかで

128
00:05:57,723 --> 00:05:59,723
プレイヤーの生命力（health) を減らすところが必要です。

129
00:05:59,723 --> 00:06:01,723
この関数はこのスクリプトからコールされませんが、

130
00:06:01,723 --> 00:06:03,723
プレイヤーを撃つ敵から

131
00:06:03,723 --> 00:06:06,337
コールされます。このため、

132
00:06:06,337 --> 00:06:08,337
この関数は public とする必要があります。

133
00:06:08,337 --> 00:06:11,091
TakeDamage 関数をコールして

134
00:06:11,091 --> 00:06:13,919
プレイヤーが受けたダメージを Parse する必要があります。

135
00:06:15,303 --> 00:06:17,303
この関数ですべきことは、

136
00:06:17,303 --> 00:06:19,858
health をパラメータの amount 分の大きさだけ減少させることです。

137
00:06:20,551 --> 00:06:22,551
このスクリプトでの作業は完了です。

138
00:06:22,551 --> 00:06:24,551
保存をして、エディタに戻ります。

139
00:06:27,648 --> 00:06:30,670
最後にシーンおよびプロジェクトを保存します。

140
00:06:33,156 --> 00:06:34,822
このチャプターはこれで完了です。

141
00:06:34,822 --> 00:06:36,822
プレイヤーはほとんど完成であり、

142
00:06:36,822 --> 00:06:38,822
もうひとつだけ短いスクリプトが必要であり、

143
00:06:38,822 --> 00:06:40,822
それは次のチャプターで追加します。

144
00:06:40,822 --> 00:06:42,822
次のチャプターでは、レベル全体を動作させるのに必要な

145
00:06:42,822 --> 00:06:44,822
ことをカバーしていきます。

146
00:06:44,822 --> 00:06:46,822
これにはカメラ、ドア、

147
00:06:46,822 --> 00:06:48,822
鍵、そして昇降エレベータが含まれます。
(翻訳:gamesonytablet)
